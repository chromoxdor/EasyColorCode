var rEdit,commonAtoms=["And","Or"],commonKeywords=["If","Else","Elseif","Endif"],commonCommands=["AccessInfo","Background","Build","ClearAccessBlock","ClearRTCam","Config","ControllerDisable","ControllerEnable","DateTime","Debug","DeepSleep","DisablePriorityTask","DNS","DST","EraseSDKWiFi","ExecuteRules","Gateway","I2Cscanner","IP","Let","Load","LogEntry","LogPortStatus","LoopTimerSet","LoopTimerSet_ms","MemInfo","MemInfoDetail","Name","Password","Publish","Reboot","Reset","Save","SendTo","SendToHTTP","SendToUDP","Settings","Subnet","Subscribe","TaskClear","TaskClearAll","TaskDisable","TaskEnable","TaskRun","TaskValueSet","TaskValueSetAndRun","TimerPause","TimerResume","TimerSet","TimerSet_ms","TimeZone","UdpPort","UdpTest","Unit","UseNTP","WdConfig","WdRead","WiFi","WiFiAPkey","WiFiAllowAP","WiFiAPMode","WiFiConnect","WiFiDisconnect","WiFiKey","WiFiKey2","WiFiScan","WiFiSSID","WiFiSSID2","WiFiSTAMode","WiFi#Disconnected","Event","AsyncEvent","GPIO","GPIOToggle","LongPulse","LongPulse_mS","Monitor","Pulse","PWM","Servo","Status","Tone","RTTTL","UnMonitor",],commonString2=["Clock#Time","Login#Failed","MQTT#Connected","MQTT#Disconnected","MQTTimport#Connected","MQTTimport#Disconnected","Rules#Timer","System#Boot","System#BootMode","System#Sleep","System#Wake","TaskExit#","TaskInit#","Time#Initialized","Time#Set","WiFi#APmodeDisabled","WiFi#APmodeEnabled","WiFi#ChangedAccesspoint","WiFi#ChangedWiFichannel","WiFi#Connected"],commonPlugins=["ResetPulseCounter","SetPulseCounterTotal","LogPulseStatistic","analogout","MCPGPIO","MCPGPIOToggle","MCPLongPulse","MCPLongPulse_ms","MCPPulse","Status,MCP","Monitor,MCP","MonitorRange,MCP","UnMonitorRange,MCP","UnMonitor,MCP","MCPGPIORange","MCPGPIOPattern","MCPMode","MCPModeRange","LCDCmd","LCD","PCFGPIO","PCFGPIOToggle","PCFLongPulse","PCFLongPulse_ms","PCFPulse","Status,PCF","Monitor,PCF","MonitorRange,PCF","UnMonitorRange,PCF","UnMonitor,PCF","PCFGPIORange","PCFGPIOpattern","PCFMode","PCFmodeRange","pcapwm","pcafrq","mode2","OLED","OLEDCMD","OLEDCMD,on","OLEDCMD,off","OLEDCMD,clear","IRSEND","IRSENDAC","OledFramedCmd","OledFramedCmd,Display","OledFramedCmd,Frame","OledFramedCmd,linecount","OledFramedCmd,leftalign","NeoPixel","NeoPixelAll","NeoPixelLine","NeoPixelHSV","NeoPixelAllHSV","NeoPixelLineHSV","MotorShieldCmd,DCMotor","MotorShieldCmd,Stepper","Sensair_SetRelay","PMSX003","PMSX003,Wake","PMSX003,Sleep","PMSX003,Reset","encwrite","Play","Vol","Eq","Mode","Repeat","tareChanA","tareChanB","7dn","7dst","7dsd","7dtext","7dtt","7dt","7dtfont","7dtbin","7don","7doff","7output","HLWCalibrate","HLWReset","WemosMotorShieldCMD","LolinMotorShieldCMD","GPS","GPS,Sleep","GPS,Wake","GPS#GotFix","GPS#LostFix","GPS#Travelled","homieValueSet","HeatPumpir","MitsubishiHP","MitsubishiHP,temperature","MitsubishiHP,power","MitsubishiHP,mode","MitsubishiHP,fan","MitsubishiHP,vane","MitsubishiHP,widevane","Culreader_Write","Touch","Touch,Rot","Touch,Flip","Touch,Enable","Touch,Disable","Touch,On","Touch,Off","Touch,Toggle","Touch,Setgrp","Touch,Ingrp","Touch,Decgrp","Touch,Incpage","Touch,Decpage","Touch,Updatebutton","WakeOnLan","DotMatrix","DotMatrix,clear","DotMatrix,update","DotMatrix,size","DotMatrix,txt","DotMatrix,settxt","DotMatrix,content","DotMatrix,alignment","DotMatrix,anim.in","DotMatrix,anim.out","DotMatrix,speed","DotMatrix,pause","DotMatrix,font","DotMatrix,layout","DotMatrix,inverted","DotMatrix,specialeffect","DotMatrix,offset","DotMatrix,brightness","DotMatrix,repeat","DotMatrix,setbar","DotMatrix,bar","Thermo","Thermo,Up","Thermo,Down","Thermo,Mode","Thermo,ModeBtn","Thermo,Setpoint","Max1704xclearalert","scdgetabc","scdgetalt","scdgettmp","scdsetcalibration","scdsetfrc","scdgetinterval","multirelay","multirelay,on","multirelay,off","multirelay,set","multirelay,get","multirelay,loop","ShiftOut","ShiftOut,Set","ShiftOut,SetNoUpdate","ShiftOut,Update","ShiftOut,SetAll","ShiftOut,SetAllNoUpdate","ShiftOut,SetAllLow","ShiftOut,SetAllHigh","ShiftOut,SetChipCount","ShiftOut,SetHexBin","ShiftIn","ShiftIn,PinEvent","ShiftIn,ChipEvent","ShiftIn,SetChipCount","ShiftIn,SampleFrequency","ShiftIn,EventPerPin","cdmrst","axp,ldo2","axp,ldo3","axp,ldoio","axp,gpio0","axp,gpio1","axp,gpio2","axp,gpio3","axp,gpio4","axp,dcdc2","axp,dcdc3","axp,ldo2map","axp,ldo3map","axp,ldoiomap","axp,dcdc2map","axp,dcdc3map","axp,ldo2perc","axp,ldo3perc","axp,ldoioperc","axp,dcdc2perc","axp,dcdc3perc"],pluginDispKind=["tft","ili9341","ili9342","ili9481","ili9486","ili9488","eink","epaper","il3897","uc8151d","ssd1680","ws2in7","ws1in54","st77xx","st7735","st7789","st7796","neomatrix","neo"],pluginDispCmd=["cmd,on","cmd,off","cmd,clear","cmd,backlight","cmd,bright","cmd,deepsleep","cmd,seq_start","cmd,seq_end","cmd,inv","cmd,rot",",clear",",rot",",tpm",",txt",",txp",",txz",",txc",",txs",",txtfull",",asciitable",",font",",l",",lh",",lv",",lm",",lmr",",r",",rf",",c",",cf",",rf",",t",",tf",",rr",",rrf",",px",",pxh",",pxv",",bmp",",btn"],commonTag=["On","Do","Endon"],commonNumber=["toBin","toHex","Constrain","XOR","AND:","OR:","Ord","bitRead","bitSet","bitClear","bitWrite","urlencode"],commonMath=["Log","Ln","Abs","Exp","Sqrt","Sq","Round","Sin","Cos","Tan","aSin","aCos","aTan","Sin_d","Cos_d","Tan_d","aSin_d","aCos_d","aTan_d"],commonWarning=["delay","Delay","ResetFlashWriteCounter"],AnythingElse=["%eventvalue%","%eventpar%","%eventname%","substring","%sysname%","%bootcause%","%systime%","%systm_hm%","%systm_hm_0%","%systm_hm_sp%","%systime_am%","%systime_am_0%","%systime_am_sp%","%systm_hm_am%","%systm_hm_am_0%","%systm_hm_am_sp%","%lcltime%","%sunrise%","%s_sunrise%","%m_sunrise%","%sunset%","%s_sunset%","%m_sunset%","%lcltime_am%","%syshour%","%syshour_0%","%sysmin%","%sysmin_0%","%syssec%","%syssec_0%","%sysday%","%sysday_0%","%sysmonth%","%sysmonth_0%","%sysyear%","%sysyear_0%","%sysyears%","%sysweekday%","%sysweekday_s%","%unixtime%","%uptime%","%uptime_ms%","%rssi%","%ip%","%unit%","%ssid%","%bssid%","%wi_ch%","%iswifi%","%vcc%","%mac%","%mac_int%","%isntp%","%ismqtt%","%dns%","%dns1%","%dns2%","%flash_freq%","%flash_size%","%flash_chip_vendor%","%flash_chip_model%","%fs_free%","%fs_size%","%cpu_id%","%cpu_freq%","%cpu_model%","%cpu_rev%","%cpu_cores%","%board_name%","%c_w_dir%","%c_c2f%","%c_ms2Bft%","%c_dew_th%","%c_alt_pres_sea%","%c_sea_pres_alt%","%c_cm2imp%","%c_mm2imp%","%c_m2day%","%c_m2dh%","%c_m2dhm%","%c_s2dhms%","%c_2hex%","%c_u2ip%"];for(const element2 of pluginDispKind)commonPlugins=commonPlugins.concat(element2);for(const element2 of pluginDispKind)for(const element3 of pluginDispCmd){let e=element2+element3;commonPlugins=commonPlugins.concat(e)}var EXTRAWORDS=commonAtoms.concat(commonPlugins,commonKeywords,commonCommands,commonString2,commonTag,commonNumber,commonMath,commonWarning,AnythingElse);function initCM(){var e=!0;/Android/.test(navigator.userAgent)&&(e=!!confirm("Do you want to enable colored rules")),e&&(CodeMirror.commands.autocomplete=function(e){e.showHint({hint:CodeMirror.hint.anyword})},(rEdit=CodeMirror.fromTextArea(document.getElementById("rules"),{tabSize:2,indentWithTabs:!1,lineNumbers:!0,autoCloseBrackets:!0,extraKeys:{"Ctrl-Space":"autocomplete",Tab(e){"null"===e.getMode().name?e.execCommand("insertTab"):e.somethingSelected()?e.execCommand("indentMore"):e.execCommand("insertSoftTab")},"Shift-Tab":e=>e.execCommand("indentLess")}})).on("change",function(){rEdit.save()}),rEdit.on("inputRead",function(e,t){var o=e.getCursor(),n=e.getTokenAt(o);/[\w%,#]/.test(t.text)&&"comment"!=n.type&&e.showHint({completeSingle:!1})}))}!function(e){"object"==typeof exports&&"object"==typeof module?e(require("codemirror")):"function"==typeof define&&define.amd?define(["codemirror"],e):e(CodeMirror)}(function(e){"use strict";e.defineMode("espeasy",function(){var e={};function t(t,o){for(var n=0;n<o.length;n++)e[o[n]]=t}var o=commonCommands.map(e=>e.toLowerCase());commonCommands=commonCommands.concat(o);var n=commonString2.map(e=>e.toLowerCase());commonString2=commonString2.concat(n);var i=commonPlugins.map(e=>e.toLowerCase());commonPlugins=commonPlugins.concat(i);var a=commonAtoms.map(e=>e.toLowerCase());commonAtoms=commonAtoms.concat(a);var r=commonKeywords.map(e=>e.toLowerCase());commonKeywords=commonKeywords.concat(r);var s=commonTag.map(e=>e.toLowerCase());commonTag=commonTag.concat(s);var c=commonNumber.map(e=>e.toLowerCase());commonNumber=commonNumber.concat(c);var m=commonMath.map(e=>e.toLowerCase());function l(t,o){if(t.eatSpace())return null;t.sol();var n=t.next();if(/\d/.test(n)){if("0"==n)return"x"===t.next()?(t.eatWhile(/\w/),"number"):(t.eatWhile(/\d|\./),"number");if(t.eatWhile(/\d|\./),!t.match("d")&&!t.match("output")&&(t.eol()||/\D/.test(t.peek())))return"number"}if(/\w/.test(n))for(let i of EXTRAWORDS){let a=i.substring(1);(i.includes(":")||i.includes(","))&&t.match(a)}if(/\w/.test(n)&&(t.eatWhile(/[\w]/),t.match(".gpio")||t.match(".pulse")||t.match(".frq")||t.match(".pwm")))return"def";if("\\"===n)return t.next(),null;if("("===n||")"===n)return"bracket";if("{"===n||"}"===n||":"===n)return"number";if("/"==n)return/\//.test(t.peek())?(t.skipToEnd(),"comment"):"operator";if("'"==n&&(t.eatWhile(/[^']/),t.match("'")))return"attribute";if("+"===n||"="===n||"<"===n||">"===n||"-"===n||","===n||"*"===n||"!"===n)return"operator";if("%"==n){if(/\d/.test(t.next()))return"number";if(t.eatWhile(/[^\s\%]/),t.match("%"))return"hr"}if("["==n&&(t.eatWhile(/[^\s\]]/),t.eat("]")))return"hr";t.eatWhile(/\w/);var r=t.current();return/\w/.test(n)&&t.match("#")?(t.eatWhile(/[\w#]/),"string-2"):"#"===n?(t.eatWhile(/\w/),"number"):e.hasOwnProperty(r)?e[r]:null}return commonMath=commonMath.concat(m),t("atom",commonAtoms),t("keyword",commonKeywords),t("builtin",commonCommands),t("string-2",commonString2),t("def",commonPlugins),t("tag",commonTag),t("number",commonNumber),t("bracket",commonMath),t("warning",commonWarning),{startState:function(){return{tokens:[]}},token:function(e,t){var o,n;return o=e,((n=t).tokens[0]||l)(o,n)},closeBrackets:"[]{}''\"\"``()",lineComment:"//",fold:"brace"}})}),function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],mod):e(CodeMirror)}(function(e){var t={pairs:"()[]{}''\"\"",closeBefore:")]}'\":;>",triples:"",explode:"[]{}"},o=e.Pos;function n(e,o){return"pairs"==o&&"string"==typeof e?e:"object"==typeof e&&null!=e[o]?e[o]:t[o]}e.defineOption("autoCloseBrackets",!1,function(t,o,r){r&&r!=e.Init&&(t.removeKeyMap(i),t.state.closeBrackets=null),o&&(a(n(o,"pairs")),t.state.closeBrackets=o,t.addKeyMap(i))});var i={Backspace:function t(i){var a=s(i);if(!a||i.getOption("disableInput"))return e.Pass;for(var r=n(a,"pairs"),c=i.listSelections(),m=0;m<c.length;m++){if(!c[m].empty())return e.Pass;var d=l(i,c[m].head);if(!d||r.indexOf(d)%2!=0)return e.Pass}for(var m=c.length-1;m>=0;m--){var u=c[m].head;i.replaceRange("",o(u.line,u.ch-1),o(u.line,u.ch+1),"+delete")}},Enter:function t(o){var i=s(o),a=i&&n(i,"explode");if(!a||o.getOption("disableInput"))return e.Pass;for(var r=o.listSelections(),m=0;m<r.length;m++){if(!r[m].empty())return e.Pass;var d=l(o,r[m].head);if(!d||a.indexOf(d)%2!=0)return e.Pass}o.operation(function(){var e=o.lineSeparator()||"\n";o.replaceSelection(e+e,null),c(o,-1),r=o.listSelections();for(var t=0;t<r.length;t++){var n=r[t].head.line;o.indentLine(n,null,!0),o.indentLine(n+1,null,!0)}})}};function a(e){for(var t=0;t<e.length;t++){var o=e.charAt(t),n="'"+o+"'";i[n]||(i[n]=r(o))}}function r(t){return function(i){return function t(i,a){var r=s(i);if(!r||i.getOption("disableInput"))return e.Pass;var l=n(r,"pairs"),u=l.indexOf(a);if(-1==u)return e.Pass;for(var p=n(r,"closeBefore"),h=n(r,"triples"),f=l.charAt(u+1)==a,g=i.listSelections(),S=u%2==0,P=0;P<g.length;P++){var C,M,T=g[P],x=T.head,y=i.getRange(x,o(x.line,x.ch+1));if(S&&!T.empty())M="surround";else if((f||!S)&&y==a)M=f&&d(i,x)?"both":h.indexOf(a)>=0&&i.getRange(x,o(x.line,x.ch+3))==a+a+a?"skipThree":"skip";else if(f&&x.ch>1&&h.indexOf(a)>=0&&i.getRange(o(x.line,x.ch-2),x)==a+a){if(x.ch>2&&/\bstring/.test(i.getTokenTypeAt(o(x.line,x.ch-2))))return e.Pass;M="addFour"}else if(f){var b=0==x.ch?" ":i.getRange(o(x.line,x.ch-1),x);if(e.isWordChar(y)||b==a||e.isWordChar(b))return e.Pass;M="both"}else{if(!(S&&(0===y.length||/\s/.test(y)||p.indexOf(y)>-1)))return e.Pass;M="both"}if(C){if(C!=M)return e.Pass}else C=M}var v=u%2?l.charAt(u-1):a,D=u%2?a:l.charAt(u+1);i.operation(function(){if("skip"==C)c(i,1);else if("skipThree"==C)c(i,3);else if("surround"==C){for(var e=i.getSelections(),t=0;t<e.length;t++)e[t]=v+e[t]+D;i.replaceSelections(e,"around"),e=i.listSelections().slice();for(var t=0;t<e.length;t++)e[t]=m(e[t]);i.setSelections(e)}else"both"==C?(i.replaceSelection(v+D,null),i.triggerElectric(v+D),c(i,-1)):"addFour"==C&&(i.replaceSelection(v+v+v+v,"before"),c(i,1))})}(i,t)}}function s(e){var t=e.state.closeBrackets;return!t||t.override?t:e.getModeAt(e.getCursor()).closeBrackets||t}function c(e,t){for(var o=[],n=e.listSelections(),i=0,a=0;a<n.length;a++){var r=n[a];r.head==e.getCursor()&&(i=a);var s=r.head.ch||t>0?{line:r.head.line,ch:r.head.ch+t}:{line:r.head.line-1};o.push({anchor:s,head:s})}e.setSelections(o,i)}function m(t){var n=e.cmpPos(t.anchor,t.head)>0;return{anchor:new o(t.anchor.line,t.anchor.ch+(n?-1:1)),head:new o(t.head.line,t.head.ch+(n?1:-1))}}function l(e,t){var n=e.getRange(o(t.line,t.ch-1),o(t.line,t.ch+1));return 2==n.length?n:null}function d(e,t){var n=e.getTokenAt(o(t.line,t.ch+1));return/\bstring/.test(n.type)&&n.start==t.ch&&(0==t.ch||!/\bstring/.test(e.getTokenTypeAt(t)))}a(t.pairs+"`")});